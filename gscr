#!/usr/bin/python3
# Source: https://github.com/nhtri2003gmail/CTFNote?tab=readme-ov-file#genscr

import sys, os, subprocess

program = sys.argv[1]
if len(sys.argv) > 2: libc = sys.argv[2]

script = f'''#!/usr/bin/python3

from pwnaio import *

exe = './{program if len(sys.argv) != 1 else ""}'
elf = context.binary = ELF(exe, checksec = False)
{("libc = ELF('./" + libc + "', checksec=False)") if len(sys.argv) != 2 else "libc = elf.libc"}


def GDB(): gdb.attach(p, gdbscript=\'\'\'


c
\'\'\') if not args.REMOTE else None

p = remote('', ) if args.REMOTE else process(argv=[exe], aslr=False)
if args.GDB: GDB(); input()
#⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯#



p.interactive()'''

with open('exploit.py', 'wt') as f:
    f.write(script)

os.system('chmod +x ' + program)
os.chmod('exploit.py', 0o755)
os.system('subl exploit.py')
# copy to /usr/local/bin then chmod +x
# usage: genscr <file> <libc (optional)>
